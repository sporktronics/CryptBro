/*
  
  Stupid-Simple RPC
  (c) 2012 Sporktronics, LLC
  http://www.sporktronics.com/
  
  Licensed under the Lesser GPL, version 3.0:
     http://www.gnu.org/licenses/lgpl-3.0.html
  
*/var SSRPC=SSRPC||{};(function(){var a=this;a._data=[],a._onError=[],a._onInfo=[],a._onWarn=[],a._onData=[],SSRPC.cmd=function(a,b,c,d,e){b?SSRPC.send({cmd:a,data:b},c,d,e):SSRPC.send({cmd:a},c,d,e)},SSRPC.send=function(b,c,d,e){function f(){var a=!1;if(typeof ActiveXObject!="undefined")try{a=new ActiveXObject("Msxml2.XMLHTTP")}catch(b){try{a=new ActiveXObject("Microsoft.XMLHTTP")}catch(c){a=!1}}else if(window.XMLHttpRequest)try{a=new XMLHttpRequest}catch(b){a=!1}return a}var g=f();g?(g.open("POST",c,!0),g.setRequestHeader("Content-type","application/json"),g.send(JSON.stringify({ssrpc:b})),g.onreadystatechange=function(){g.readyState===2?g.onprogress=e:g.readyState===4&&(g.status===200?g.responseText?a._handleResponse(JSON.parse(g.responseText),d):a._handleResponse({},d):a._handleResponse({ssrpc:{error:{request:"Error making asynchronous request"}}},d))}):a._handleResponse({ssrpc:{error:{noAjax:"Asynchronous requests not supported"}}},d)},SSRPC.onError=function(b){a._onError.push(b)},SSRPC.onInfo=function(b){a._onInfo.push(b)},SSRPC.onWarn=function(b){a._onWarn.push(b)},SSRPC.onData=function(b){a._onData.push(b)},SSRPC.getData=function(){return a._data},SSRPC.getLastData=function(){return a._data[a._data.length-1]},a._handleResponse=function(b,c){b||(b={}),b.ssrpc?a._data.push(b.ssrpc):b.ssrpc={warn:{emptyResponse:"The response from the server was empty."}},b.ssrpc.error&&a._handleAll(a._onError,b.ssrpc.error),b.ssrpc.info&&a._handleAll(a._onInfo,b.ssrpc.info),b.ssrpc.warn&&a._handleAll(a._onWarn,b.ssrpc.warn),b.ssrpc.data&&a._handleAll(a._onData,b.ssrpc.data),c&&c(b)},a._handleAll=function(a,b){for(i in a)for(j in b)a[i]({name:j,message:b[j]})}})();var JSON;JSON||(JSON={}),function(){function f(a){return a<10?"0"+a:a}function quote(a){return escapable.lastIndex=0,escapable.test(a)?'"'+a.replace(escapable,function(a){var b=meta[a];return typeof b=="string"?b:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+a+'"'}function str(a,b){var c,d,e,f,g=gap,h,i=b[a];i&&typeof i=="object"&&typeof i.toJSON=="function"&&(i=i.toJSON(a)),typeof rep=="function"&&(i=rep.call(b,a,i));switch(typeof i){case"string":return quote(i);case"number":return isFinite(i)?String(i):"null";case"boolean":case"null":return String(i);case"object":if(!i)return"null";gap+=indent,h=[];if(Object.prototype.toString.apply(i)==="[object Array]"){f=i.length;for(c=0;c<f;c+=1)h[c]=str(c,i)||"null";return e=h.length===0?"[]":gap?"[\n"+gap+h.join(",\n"+gap)+"\n"+g+"]":"["+h.join(",")+"]",gap=g,e}if(rep&&typeof rep=="object"){f=rep.length;for(c=0;c<f;c+=1)typeof rep[c]=="string"&&(d=rep[c],e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e))}else for(d in i)Object.prototype.hasOwnProperty.call(i,d)&&(e=str(d,i),e&&h.push(quote(d)+(gap?": ":":")+e));return e=h.length===0?"{}":gap?"{\n"+gap+h.join(",\n"+gap)+"\n"+g+"}":"{"+h.join(",")+"}",gap=g,e}}"use strict",typeof Date.prototype.toJSON!="function"&&(Date.prototype.toJSON=function(a){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null},String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(a){return this.valueOf()});var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;typeof JSON.stringify!="function"&&(JSON.stringify=function(a,b,c){var d;gap="",indent="";if(typeof c=="number")for(d=0;d<c;d+=1)indent+=" ";else typeof c=="string"&&(indent=c);rep=b;if(!b||typeof b=="function"||typeof b=="object"&&typeof b.length=="number")return str("",{"":a});throw new Error("JSON.stringify")}),typeof JSON.parse!="function"&&(JSON.parse=function(text,reviver){function walk(a,b){var c,d,e=a[b];if(e&&typeof e=="object")for(c in e)Object.prototype.hasOwnProperty.call(e,c)&&(d=walk(e,c),d!==undefined?e[c]=d:delete e[c]);return reviver.call(a,b,e)}var j;text=String(text),cx.lastIndex=0,cx.test(text)&&(text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)}));if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,"")))return j=eval("("+text+")"),typeof reviver=="function"?walk({"":j},""):j;throw new SyntaxError("JSON.parse")})}();